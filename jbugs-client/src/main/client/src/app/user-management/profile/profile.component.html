<link rel="stylesheet"
      href="https://cdn.rawgit.com/tonystar/bootstrap-float-label/v3.0.1/dist/bootstrap-float-label.min.css"/>

<button (click)="showAddPopup()" type="button" class="btn btn-lg btn-default"
        style="background-color: darkred; color: white; margin-bottom: 1em;" data-toggle="modal"
        data-target="#addModal">
  {{ 'demo.Add User' | translate }}
</button>

<div class="column justify-content-center">
  <div *ngIf="userList">
    <div class="table-responsive">
      <table class="table table-hover table-dark table-striped shadow p-3 mb-5 rounded" id="usersTable">
        <thead style="background-color: darkred; border-color: darkred;">
        <tr>
          <th scope="col" translate>demo.Username</th>
          <th scope="col" translate>demo.First name</th>
          <th scope="col" translate>demo.Last name</th>
          <th scope="col" translate>demo.Phone number</th>
          <th scope="col" translate>E-mail</th>
          <th scope="col" translate>demo.Roles</th>
          <th scope="col" translate>demo.Active</th>
          <th scope="col" translate>demo.Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let user of userList" #row>
          <td>{{ user.username }}</td>
          <td>{{ user.firstName }}</td>
          <td>{{ user.lastName }}</td>
          <td>{{ user.phoneNumber }}</td>
          <td>{{ user.email }}</td>
          <td>
            <mat-menu #appMenu="matMenu">
                <span *ngFor="let role of user.roles">
                  <button mat-menu-item> {{role.type}} </button>
                </span>
            </mat-menu>
            <button mat-icon-button [matMenuTriggerFor]="appMenu">
              <mat-icon>list</mat-icon>
            </button>
          </td>
          <td>
            <i class="material-icons" *ngIf="user.isActive" style="font-size: 28px; cursor: default;">check_circle_outline</i>
            <i class="material-icons" *ngIf="!user.isActive" style="font-size: 28px; cursor: default;">highlight_off</i>
          </td>
          <td>
            <div style="display: flex; flex-direction: row; justify-content: center; align-items: center;">
              <i class="material-icons" data-toggle="modal" data-target="#editModal" (click)="passDataToModal(user)">edit</i>
              <button type="button" class="btn btn-default" style="background-color: darkred; color: white;"
                      (click)="disableUser(user)" *ngIf="user.isActive" translate>demo.Disable
              </button>
              <button type="button" class="btn btn-default" style="background-color: limegreen; color: white;"
                      (click)="enableUser(user)" *ngIf="!user.isActive" translate>demo.Enable
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color: darkred; margin-right: -0.5px; margin-top: -1px ">
        <h5 class="modal-title" id="editModalTitle" translate style="color: whitesmoke;font-size: 20px; ">demo.Manage
          user</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: #fff; font-size: 20px" aria-label="Close"
                (click)="pressedEdit=false;errorOccurred=false;positiveResponse=false;clearUserModelFields();">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form class="form-signin text-center"
              (ngSubmit)="submitEditForm()"
              #formControl="ngForm">
          <h1 class="h1 mb-3 font-weight-normal" translate>demo.Edit a user</h1><br>
          <span class="form-group has-float-label">
                  <span class="help-block"
                        *ngIf="firstName.errors?.required && firstName.touched" translate style="margin-top: 15px">demo.First name is required.</span>
                  <span class="help-block"
                        *ngIf="firstName.errors?.minlength && firstName.touched" translate style="margin-top: 15px">demo.First name is invalid.</span>
                  <input type="text"
                         name="firstName"
                         minlength="2"
                         pattern="[a-zA-Z]+"
                         id="firstNameInputUpdate"
                         #firstName="ngModel"
                         #firstNameId
                         class="form-control"
                         required
                         [(ngModel)]="userModel.firstName"
                         placeholder=" ">
                  <label for="firstNameInput" translate style="margin-top: 15px">demo.First name</label>
          </span>
          <span class="form-group has-float-label">
                <span class="help-block"
                      *ngIf="lastName.errors?.required && lastName.touched" translate style="margin-top: 15px">demo.Last name is required.</span>
                <span class="help-block"
                      *ngIf="lastName.errors?.minlength && lastName.touched" translate style="margin-top: 15px">demo.Last name is invalid.</span>
                <input type="text"
                       name="lastName"
                       minlength="2"
                       pattern="[a-zA-Z]+"
                       id="lastNameInputUpdate"
                       #lastName="ngModel"
                       #lastNameId
                       class="form-control"
                       required
                       [(ngModel)]="userModel.lastName"
                       placeholder=" ">
                <label for="lastNameInput" translate style="margin-top: 15px">demo.Last name</label>
              </span>


          <span class="form-group has-float-label">
              <span class="help-block" *ngIf="phone.errors?.required && phone.touched" translate
                    style="margin-top: 15px">demo.Phone number is required.</span>
              <span class="help-block" *ngIf="phone.errors?.minlength && phone.touched" translate
                    style="margin-top: 15px">demo.Phone number is invalid.</span>
              <input type="text"
                     name="mobileNumber"
                     minlength="10"
                     pattern="[+0-9]+"
                     id="mobileNumberInputUpdate"
                     #phone="ngModel"
                     #phoneId
                     class="form-control"
                     required
                     [(ngModel)]="userModel.phoneNumber"
                     placeholder=" ">
              <label for="mobileNumberInput" translate style="margin-top: 15px">demo.Phone number</label>
            </span>

          <span class="form-group has-float-label">
              <span class="help-block" *ngIf="email.errors?.required && email.touched" translate
                    style="margin-top: 15px">E-mail is required.</span>
              <span class="help-block" *ngIf="email.errors?.pattern && email.touched" translate
                    style="margin-top: 15px">E-mail is invalid.</span>
              <input type="text"
                     name="email"
                     minlength="5"
                     pattern="^[a-zA-Z]*@msggroup.com$"
                     id="emailInputUpdate"
                     #email="ngModel"
                     #emailId
                     class="form-control"
                     required
                     [(ngModel)]="userModel.email"
                     placeholder=" ">
              <label for="emailInput" style="margin-top: 15px">E-mail</label>
            </span>

          <span class="form-group has-float-label">
            <mat-form-field>
              <mat-select placeholder="Select roles" [formControl]="editRolesFormControl" multiple
                          (selectionChange)="setRoles(rolesFormControl.value)">
                <mat-select-trigger>
                  Roles selected
                </mat-select-trigger>
                <mat-option *ngFor="let role of roles" [value]="role">
                  {{role.type}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </span>


          <button class="btn btn-lg btn-block" type="submit" id="buttonEditId"
                  style="background-color: darkred;margin-top: 30px; color: white;  color: whitesmoke; font-size: 15px; position: center"
                  [disabled]="formControl.invalid" translate
          >demo.Edit
          </button>
          <button type="button" class="btn btn-block" data-dismiss="modal"
                  style="background-color: darkred; color: white; color: whitesmoke; font-size: 15px; position: center"
                  (click)="pressedEdit=false;"  translate>
            demo.Back
          </button>
          <label *ngIf="errorOccurred" class="errorLabel" style="position: center;">{{errorMessage}}</label>
          <label *ngIf="positiveResponse" class="successLabel">Action completed successfully</label>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color: darkred; margin-right: -0.5px; margin-top: -1px ">
        <h5 class="modal-title" id="addModalTitle" translate style="color: whitesmoke;font-size: 20px; ">demo.Add
          user</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: #fff; font-size: 20px" aria-label="Close"
                (click)="pressedEdit=false;errorOccurred=false;positiveResponse=false;clearUserModelFields();">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <i class="material-icons" (mouseenter)="showInfo()" (mouseleave)="hideInfo()"
           style="cursor: help;margin: 0 0 0 50%">info</i>
        <div #infoDiv class="alert alert-warning"
             style="left:20%;top:30%;width: 60%; margin: 0 auto;position:fixed;z-index: 99 !important;"
             [hidden]="!showInfoDiv">
          <strong translate>demo.Keep in mind!</strong>
          <p translate style="color:black;">demo.KeepInMindMessage</p>
        </div>
        <form class="form-signin text-center"
              (ngSubmit)="submitAddForm()"
              *ngIf="pressedAdd"
              #formControl="ngForm">
              <span class="form-group has-float-label">
                  <span class="help-block"
                        *ngIf="firstName.errors?.required && firstName.touched" translate style="margin-top: 15px">demo.First name is required.</span>
                  <span class="help-block"
                        *ngIf="firstName.errors?.minlength && firstName.touched" translate style="margin-top: 15px">demo.First name is invalid.</span>
                  <input type="text"
                         name="firstName"
                         minlength="2"
                         pattern="[a-zA-Z]+"
                         id="firstNameInput"
                         #firstName="ngModel"
                         class="form-control"
                         required
                         [(ngModel)]="userModel.firstName"
                         placeholder=" ">
                  <label for="firstNameInput" translate style="margin-top: 15px">demo.First name</label>
              </span>
          <span class="form-group has-float-label">
                <span class="help-block"
                      *ngIf="lastName.errors?.required && lastName.touched" translate style="margin-top: 15px">demo.Last name is required.</span>
                <span class="help-block"
                      *ngIf="lastName.errors?.minlength && lastName.touched" translate style="margin-top: 15px">demo.Last name is invalid.</span>
                <input type="text"
                       name="lastName"
                       minlength="2"
                       pattern="[a-zA-Z]+"
                       id="lastNameInput"
                       #lastName="ngModel"
                       class="form-control"
                       required
                       [(ngModel)]="userModel.lastName"
                       placeholder=" ">
                <label for="lastNameInput" translate style="margin-top: 15px">demo.Last name</label>
              </span>
          <span class="form-group has-float-label">
              <span class="help-block" *ngIf="phone.errors?.required && phone.touched" translate
                    style="margin-top: 15px">demo.Phone number is required.</span>
              <span class="help-block" *ngIf="phone.errors?.minlength && phone.touched" translate
                    style="margin-top: 15px">demo.Phone number is invalid.</span>
              <input type="text"
                     name="mobileNumber"
                     minlength="10"
                     pattern="[+0-9]+"
                     id="mobileNumberInput"
                     #phone="ngModel"
                     class="form-control"
                     required
                     [(ngModel)]="userModel.phoneNumber"
                     placeholder=" ">
              <label for="mobileNumberInput" translate style="margin-top: 15px">demo.Phone number</label>
            </span>
          <span class="form-group has-float-label">
              <span class="help-block" *ngIf="email.errors?.required && email.touched" translate
                    style="margin-top: 15px">E-mail is required.</span>
              <span class="help-block" *ngIf="email.errors?.pattern && email.touched" translate
                    style="margin-top: 15px">E-mail is invalid.</span>
              <input type="text"
                     name="email"
                     minlength="5"
                     pattern="^[a-zA-Z]*@msggroup.com$"
                     id="emailInput"
                     #email="ngModel"
                     class="form-control"
                     required
                     [(ngModel)]="userModel.email"
                     placeholder=" ">
              <label for="emailInput" style="margin-top: 15px">E-mail</label>
            </span>
          <span class="form-group has-float-label" [class.has-error]="password.invalid && password.touched">
              <span class="help-block"
                    *ngIf="password.errors?.required && password.touched" translate style="margin-top: 15px">demo.Password is required.</span>
              <span class="help-block" *ngIf="password.errors?.pattern && password.touched" translate
                    style="margin-top: 15px">demo.Password is invalid.</span>
              <input type="password"
                     name="password"
                     id="passwordInput"
                     #password="ngModel"
                     class="form-control"
                     required
                     pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&].{8,20}"
                     [(ngModel)]="userModel.password"
                     placeholder=" ">
              <label for="passwordInput" translate style="margin-top: 15px">demo.Password</label>
            </span>


          <span class="form-group has-float-label">
            <mat-form-field>
              <mat-select placeholder="Select roles" [formControl]="rolesFormControl" multiple
                          (selectionChange)="setRoles(rolesFormControl.value)">
                <mat-select-trigger>
                  Roles selected
                </mat-select-trigger>
                <mat-option *ngFor="let role of roles" [value]="role">
                  {{role.type}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            </span>
          <button class="btn btn-lg btn-block" type="submit" style="background-color: darkred;margin-top: 30px; color: white; margin-bottom: 1em;  font-size: 15px; position: center"
                  [disabled]="formControl.invalid" translate>demo.Submit
          </button>
          <label *ngIf="errorOccurred" class="errorLabel">{{errorMessage}}</label>
          <label *ngIf="positiveResponse" class="successLabel">Action completed successfully</label>
        </form>
      </div>
      <!--<div class="modal-footer">-->
      <!--<button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="primulNume.value = ''">Close</button>-->
      <!--<button type="button" class="btn btn-primary">Save changes</button>-->
      <!--</div>-->
    </div>
  </div>
</div>
