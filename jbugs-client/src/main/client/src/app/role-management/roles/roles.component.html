<div class="column justify-content-center">
  <div class="mat-elevation-z6 data-table">
    <table mat-table [dataSource]="roleList" style="position: sticky; width: 100%;"
           class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp full-width">
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> Role type</th>
        <td mat-cell *matCellDef="let role"> {{role.type}}</td>
      </ng-container>
      <ng-container matColumnDef="permissionTypes">
        <th mat-header-cell *matHeaderCellDef> Permission type</th>
        <td mat-cell *matCellDef="let role">
          <table [dataSource]="role.permissions" mat-table style="position: sticky; width: 100%;"
                 class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp full-width">
            <ng-container matColumnDef="type">
              <td mat-cell *matCellDef="let permission"> {{permission.type}}</td>
            </ng-container>
            <tr mat-row *matRowDef="let myRowData2; columns: ['type']"></tr>
          </table>
        </td>
      </ng-container>
      <ng-container matColumnDef="permissionDescriptions">
        <th mat-header-cell *matHeaderCellDef> Permission description</th>
        <td mat-cell *matCellDef="let role">
          <table [dataSource]="role.permissions" mat-table style="position: sticky; width: 100%;"
                 class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp full-width">
            <ng-container matColumnDef="description">
              <td mat-cell *matCellDef="let permission"> {{permission.description}}</td>
            </ng-container>
            <tr mat-row *matRowDef="let myRowData2; columns: ['description']"></tr>
          </table>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let myRowData; columns: columnsToDisplay" (click)="editRole(myRowData)"></tr>
    </table>
  </div>
  <button class="btn btn-default" style="margin: 2em 0 0 0;" (click)="logout()">Logout</button>
</div>

<popup #popup style="background: black;">
  <p>{{message}}</p>
  <form class="form-signin"
        (ngSubmit)="submitRoleForm()"
        *ngIf="pressedEdit"
        #formControl="ngForm">
    <h1 class="h3 mb-3 font-weight-normal">Edit a user</h1>
    <span>
        <input type="text" id="inputRoleType" class="form-control"
               name="roleType"
               required
               readonly
               placeholder="{{selectedRole.type}}">
      </span>

    <div class="item" *ngFor="let permission of selectedRole.permissions" style="display: inline;">
      <input type="text" id="inputPermissionType" class="form-control" name="permissionType"
             required
             readonly
             placeholder="{{permission.type}}">
      <button type="button" class="btn btn-lg btn-danger" (click)="removePermission(permission)">Remove</button>
    </div>
    <button type="button" class="btn btn-lg btn-default" (click)="addPermissions()"> Add new permission</button>
  </form>
  <button type="button" class="btn btn-default" style="margin-right: 1em;" (click)="showEditPopup()"
          *ngIf="!pressedEdit">Edit
  </button>
  <button type="button" class="btn btn-default" style="margin-right: 1em;" (click)="hidePopup()" *ngIf="!pressedEdit">
    Cancel
  </button>
  <button type="button" class="btn btn-default" style="margin-right: 1em;" (click)="pressedEdit=false;"
          *ngIf="pressedEdit">Back
  </button>
</popup>


<popup #permissionPopup style="background: black;">
  <form class="form-signin">
    <h1 class="h3 mb-3 font-weight-normal">Adding permissions to role {{selectedRole.type}}</h1>
    <div class="item" *ngFor="let permission of permissionsList" style="display: inline;">
      <div *ngIf="contains(permission)==false">
        <input type="text" id="perm" class="form-control" name="permissionType"
               required readonly placeholder="{{permission.type}}">
        <button class="btn btn-lg btn-danger" (click)="addPermission(permission)"> Add</button>
      </div>
    </div>
    <button class="btn btn-lg btn-danger" (click)="submitAddPermissionsForm()"> Back </button>
  </form>
</popup>
