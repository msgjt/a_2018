<link rel="stylesheet"
      href="https://cdn.rawgit.com/tonystar/bootstrap-float-label/v3.0.1/dist/bootstrap-float-label.min.css"/>

<div *ngIf="selectedBug">
  <app-edit-bug [bug]="selectedBug" [severityFormControl]="getSeverityFormControl(selectedBug)"
                [statusFormControl]="getStatusFormControl(selectedBug)"></app-edit-bug>
</div>

<div class="column justify-content-center">
  <button data-target="#addBugsModal" data-toggle="modal" class="btn btn-default"
          style="width: 12vw; position: relative; height: 40px; margin-bottom: .75em; background-color: darkred; color: white; padding-right: 1.5em; padding-bottom: .5em; font-size: 14px; margin-right: 1em;">
    <i class="fas fa-bug" style="font-size: 14px; color: white; margin-right: .25em; "></i>
    {{'demo.Add a bug' | translate }}
  </button>
  <button (click)="exportToExcel()" class="btn btn-default"
          style="width: 90px; position: relative; height: 40px; margin-bottom: .75em; background-color: darkgreen; color: white; padding-right: 1.5em; padding-bottom: .5em; font-size: 14px; margin-right: 1em;">
    <i class="fas fa-file-excel" style="font-size: 14px; color: white; margin-right: .25em;"></i>
    Excel
  </button>
  <!--<button (click)="showNotif()">da</button>-->
  <div class="mat-elevation-z6 data-table">
    <div id="tableContainer" class="table-responsive" style="text-align: center !important;">
      <table class="table table-hover table-dark table-striped shadow p-3 mb-5 rounded" id="bugsTable">
        <thead style="background-color: darkred; border-color: darkred;">
        <tr>
          <th scope="col" (click)="doSort('id')">
              <span translate>ID</span>
          </th>
          <th scope="col" (click)="doSort('title')">
              <span translate>demo.Title</span>
          </th>
          <th scope="col" (click)="doSort('description')">
              <span translate>demo.Description</span>
          </th>
          <th scope="col" (click)="doSort('fixedVersion')">
              <span translate>demo.Fixed Version</span>
          </th>
          <th scope="col" (click)="doSort('severity')">
              <span translate>demo.Severity</span>
          </th>
          <th scope="col" (click)="doSort('status')">
              <span translate>demo.Status</span>
          </th>
          <th scope="col" (click)="doSort('targetDate')">
              <span translate>demo.Target date</span>
          </th>
          <th scope="col" (click)="doSort('version')">
              <span translate>demo.Version</span>
          </th>
          <th scope="col" (click)="doSort('assignedTo')">
              <span translate>demo.Assigned to</span>
          </th>
          <th scope="col" (click)="doSort('createdBy')">
              <span translate>demo.Created by</span>
          </th>
          <th scope="col">
            <div style="display: flex; flex-direction: column; justify-content: center; text-align: center;">
              {{"demo.Attachment"|translate}}
            </div>
          </th>
          <th scope="col">
            <div tyle="display: flex; flex-direction: column; justify-content: center; text-align: center;">
              {{"demo.Actions" | translate }}
            </div>
          </th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>
            <input [(ngModel)]="filter10" (keyup)="addFilters('id')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter6" (keyup)="addFilters('title')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter1" (keyup)="addFilters('description')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter2" (keyup)="addFilters('fixedVersion')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter3" (keyup)="addFilters('severity')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter4" (keyup)="addFilters('status')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter5" (keyup)="addFilters('targetDate')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter7" (keyup)="addFilters('version')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter8" (keyup)="addFilters('assignedTo')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;">
          </td>
          <td>
            <input [(ngModel)]="filter9" (keyup)="addFilters('createdBy')" type="text" placeholder="Filter..."
                   style="margin: .5em auto;" >
          </td>
          <td></td>
          <td></td>
        </tr>
        <tr #row *ngFor="let bug of bugList | paginate: config" style="cursor: pointer;">
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal">{{
            bug.id }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal"
              data-target="#bugDetailsModal">{{ bug.title }}
          </td>
          <td class="descriptionCells" (click)="passUserToDetailedModal(bug)" data-toggle="modal"
              data-target="#bugDetailsModal">{{
            bug.description }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal">{{
            bug.fixedVersion
            }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal" translate>
            demo.{{ bug.severity }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal" translate>
            demo.{{ bug.status
            }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal">{{
            bug.targetDate.split('T')[0] }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal">{{ bug.version
            }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal">{{
            bug.assignedTo.username }}
          </td>
          <td (click)="passUserToDetailedModal(bug)" data-toggle="modal" data-target="#bugDetailsModal">{{
            bug.createdBy.username }}
          </td>
          <td style="cursor: default;">
            <i class="far fa-file-excel" style="font-size: 24px;"
               *ngIf="bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'xls' || bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'xlsx'"></i>
            <i class="far fa-file-pdf" style="font-size: 24px;"
               *ngIf="bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'pdf'"></i>
            <i class="far fa-file-word" style="font-size: 24px;"
               *ngIf="bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'doc' || bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'docx'"></i>
            <i class="far fa-image" style="font-size: 24px;"
               *ngIf="bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'png' || bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'jpg' || bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'jpeg'"></i>
            <img src="../../../assets/odffile.svg" class="far fa-file-excel" (click)="passDataToEditModal(bug)"
                 style="width: 24px; color: white"
                 *ngIf="bug.attachment.split('.')[bug.attachment.split('.').length-1] === 'odf'">
          </td>
          <td>
            <div *ngIf="bug.status != 'Closed'">
              <i class="material-icons" data-toggle="modal" data-target="#editModal" (click)="passDataToEditModal(bug)"
                 style="font-size: 24px;"> edit </i>
            </div>
          </td>
        </tr>
        </tbody>
        <caption style="margin-left: 1em; color: white; font-style: italic;">Showing {{ ((bugList.length>0) ?
          ((config.currentPage - 1) * config.itemsPerPage + 1) : 0) + '-' + ((config.currentPage*config.itemsPerPage) -
          (((bugList | tableFilter: filter).length > config.currentPage*config.itemsPerPage) ? 0 :
          (config.currentPage*config.itemsPerPage-(bugList | tableFilter: filter).length))) + ' of ' + (bugList |
          tableFilter: filter).length }} results.
        </caption>
      </table>
    </div>
    <pagination-template #p="paginationApi"
                         [id]="config.id"
                         (pageChange)="config.currentPage = $event">

      <div class="custom-pagination">
        <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
          <a *ngIf="!p.isFirstPage()" (click)="p.previous()" style="color: white"> < </a>
        </div>

        <div *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value"
             style="color: white; margin-bottom: 1em;">
          <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">
            <span>{{ page.label }}</span>
          </a>
          <div *ngIf="p.getCurrent() === page.value">
            <span>{{ page.label }}</span>
          </div>
        </div>

        <div class="pagination-next" [class.disabled]="p.isLastPage()">
          <a *ngIf="!p.isLastPage()" (click)="p.next()" style="color: white"> > </a>
        </div>
      </div>
    </pagination-template>
  </div>
</div>

<!--View Details-->
<div class="modal fade" id="bugDetailsModal" tabindex="-1" aria-labelledby="bugDetailsModalTitle" aria-hidden="true"
     *ngIf="detailedBug">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color: darkred; margin-right: -0.5px; margin-top: -1px ">
        <h5 class="modal-title" id="bugDetailsModalTitle" style="color: whitesmoke;font-size: 20px; ">Bug details</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: #fff; font-size: 20px"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="margin-top: 1em;">
        <form class="form-signin text-center"
              #formControl="ngForm">
          <span class="form-group has-float-label">
            <input type="text"
                   name="titleDetails"
                   id="titleInputDetails"
                   #titleDetails="ngModel"
                   [(ngModel)]="detailedBug.title"
                   disabled>
            <label for="titleInputDetails" style="margin-top: 15px">Title</label>
          </span>
          <div class="form-group" style="margin-bottom: 1.5em;">
            <label for="descriptionInputDetails">Description</label>
            <textarea #description="ngModel" [(ngModel)]="detailedBug.description" name="description"
                      class="form-control" id="descriptionInputDetails" rows="3" disabled></textarea>
          </div>
          <span class="form-group has-float-label">
            <input type="text"
                   name="versionDetails"
                   id="versionInputDetails"
                   #versionDetails="ngModel"
                   [(ngModel)]="detailedBug.version"
                   disabled>
            <label for="versionInputDetails" style="margin-top: 15px">Version</label>
          </span>
          <span class="form-group has-float-label">
            <input type="text"
                   name="targetDateDetails"
                   id="targetDateInputDetails"
                   #targetDateDetails="ngModel"
                   [(ngModel)]="detailedBug.targetDate.split('T')[0]"
                   disabled>
            <label for="targetDateInputDetails" style="margin-top: 15px">Target Date</label>
          </span>
          <span class="form-group has-float-label">
            <input type="text"
                   name="severityDetails"
                   id="severityInputDetails"
                   #severityDetails="ngModel"
                   [(ngModel)]="detailedBug.severity"
                   disabled>
            <label for="severityInputDetails" style="margin-top: 15px">Severity</label>
          </span>
          <span class="form-group has-float-label">
            <input type="text"
                   name="statusDetails"
                   id="statusInputDetails"
                   #statusDetails="ngModel"
                   [(ngModel)]="detailedBug.status"
                   disabled>
            <label for="statusInputDetails" style="margin-top: 15px">Status</label>
          </span>
          <span class="form-group has-float-label">
            <input type="text"
                   name="fixedVersionDetails"
                   id="fixedVersionInputDetails"
                   #fixedVersionDetails="ngModel"
                   [(ngModel)]="detailedBug.fixedVersion"
                   disabled>
            <label for="fixedVersionInputDetails" style="margin-top: 15px">Fixed Version</label>
          </span>
        </form>
      </div>
      <div class="modal-footer">
        <button *ngIf="isBUG_EXPORT_PDF()" class="btn btn-default"
                style="width: 90px; height: 40px; margin-bottom: .75em; background-color: darkred; color: white; padding-right: 1.5em; padding-bottom: .5em; font-size: 14px;">
          <i class="fas fa-file-pdf" style="font-size: 14px; color: white; margin-right: .25em;" (click)="exportToPdf(detailedBug.description,detailedBug.fixedVersion,
            detailedBug.severity,detailedBug.status,detailedBug.targetDate,
            detailedBug.title,detailedBug.version)"></i>
          PDF
        </button>
      </div>
    </div>
  </div>
</div>

<!--Add-->
<div class="modal fade" id="addBugsModal" tabindex="-1" aria-labelledby="addBugsModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color: darkred; margin-right: -0.5px; margin-top: -1px ">
        <h5 class="modal-title" id="addBugsModalTitle" style="color: whitesmoke;font-size: 20px; ">Submit a bug</h5>
        <button type="button" class="close" data-dismiss="modal" style="color: #fff; font-size: 20px"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        <i class="material-icons" (mouseenter)="showInfo()" (mouseleave)="hideInfo()"
           style="cursor: help; margin: 0 auto">info</i>
        <div #infoDiv class="alert alert-warning"
             style="left: 20%; top:25%;width: 60%; margin: 0 auto;position:fixed;z-index: 99 !important;"
             [hidden]="!showInfoDiv">
          <strong translate>demo.Keep in mind!</strong>
          <p translate style="color:black;">demo.KeepInMindMessageBug</p>
        </div>
        <form class="form-signin text-center"
              (ngSubmit)="submitAddData()"
              #formControl="ngForm">
          <div class="form-group">
            <label for="descriptionInputAdd">Description</label>
            <textarea required minlength="250" #descriptionAdd="ngModel" [(ngModel)]="bugModel.description"
                      name="descriptionAdd" class="form-control" id="descriptionInputAdd" rows="3"></textarea>
          </div>
          <span class="form-group has-float-label">
                <span class="help-block"
                      *ngIf="severityAdd.errors?.required && severityAdd.touched" translate style="margin-top: 15px">demo.Severity is required.</span>
                <input type="text"
                       name="severityAdd"
                       id="severityInputAdd"
                       #severityAdd="ngModel"
                       class="form-control"
                       required
                       placeholder=" "
                       [(ngModel)]="bugModel.severity"
                >
                <label for="severityInputAdd" translate style="margin-top: 15px">demo.Severity</label>
              </span>
          <div class="form-group">
            <div class="input-group">
              <input type="date" class="form-control" placeholder="yyyy-mm-dd"
                     name="dp" [ngModel]="bugModel.targetDate" (ngModelChange)="bugModel.targetDate = $event">
            </div>
          </div>
          <span class="form-group has-float-label">
                <span class="help-block" *ngIf="titleAdd.errors?.required && titleAdd.touched" translate
                      style="margin-top: 15px">Title is required.</span>
                <input type="text"
                       name="titleAdd"
                       id="titleInputAdd"
                       #titleAdd="ngModel"
                       class="form-control"
                       required
                       [(ngModel)]="bugModel.title"
                       placeholder=" ">
                <label for="titleInputAdd" style="margin-top: 15px">Title</label>
              </span>
          <span class="form-group has-float-label">
                <span class="help-block" *ngIf="versionAdd.errors?.required && versionAdd.touched" translate
                      style="margin-top: 15px">demo.Version is required.</span>
                <input type="text"
                       name="versionAdd"
                       id="versionInputAdd"
                       #versionAdd="ngModel"
                       class="form-control"
                       required
                       [(ngModel)]="bugModel.version"
                       placeholder=" ">
                <label for="versionInputAdd" translate style="margin-top: 15px">demo.Version</label>
              </span>
          <span class="form-group has-float-label">
                <span class="help-block" *ngIf="assignedToAdd.errors?.required && assignedToAdd.touched" translate
                      style="margin-top: 15px">demo.Version is required.</span>
                <input type="text"
                       name="assignedToAdd"
                       id="assignedToInputAdd"
                       #assignedToAdd="ngModel"
                       class="form-control"
                       required
                       [(ngModel)]="bugModel.assignedTo.username"
                       placeholder=" ">
                <label for="assignedToInputAdd" translate style="margin-top: 15px">demo.Assigned to</label>
              </span>
          <div class="form-group">
            <label for="attachmentInputAdd">Attachment</label>
            <input name="attachmentAdd" id="attachmentInputAdd" type="file" class="form-control-file"
                   (change)="fileChange($event)">
          </div>
          <button class="btn btn-lg btn-block" type="submit"
                  style="background-color: darkred;margin-top: 30px; color: white; margin-bottom: 1em;  font-size: 15px; position: center"
                  [disabled]="formControl.invalid" translate>demo.Submit
          </button>
          <label *ngIf="errorOccurred" class="errorLabel">{{errorMessage}}</label>
          <label *ngIf="positiveResponse" class="successLabel">Action completed successfully</label>
        </form>
      </div>
    </div>
  </div>
</div>
